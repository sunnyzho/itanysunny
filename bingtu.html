<!DOCTYPE html>
<html lang="en">
<head>
	<title>Document</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style>
		canvas{
			border:1px solid black;
			margin:0 auto;
			
		}
	</style>
</head>
<body>
<b>Item A:</b> <input type="text" item="A" value="80" name="item">
<br>
<br>
<b>Item B:</b> <input type="text" item="B" value="69" name="item">
<br>
<br>
<b>Item C:</b> <input type="text" item="C" value="26" name="item">
<br>
<br>
<b>Item D:</b> <input type="text" item="D" value="55" name="item">
<br>
<br>
<b>Item E:</b> <input type="text" item="E" value="25" name="item">
<br>
<br>
<b>Item F:</b> <input type="text" item="F" value="65" name="item">
<br>
<br>
<input type="submit" value="Chart" onclick="genPieChart()">
<hr>
<canvas width="400" height="400"></canvas>
<div id="target">90</div>
</body>
</html>
<script>
	let c = document.querySelector("canvas");
	let ctx = c.getContext("2d");
	const WIDTH = c.width;
	const HEIGHT = c.height;

	let items = document.querySelectorAll("input[name='item']"); 
	let X = WIDTH / 2;
	let Y = HEIGHT / 2;

	ctx.textAlign = "center";
	ctx.textBaseline = "middle";

	const R = 160;

	let texts = [];
	let TEXT_HEIGHT = 30;
	
	let colors = ["rgb(255,0,0)", "rgb(0,255,0)", "rgb(0,0,255)", "rgb(255,255,0)", "rgb(0,255,255)", "rgb(255,0,255)"];

	function genItemPercent(index){
		let value = items[index].value;
		let sum = 0;
		items.forEach(({value}) => {
			sum += (+value);
		});
		return value / sum;
	}

	function genPieChart() {
		let items = document.querySelectorAll("input[name='item']");
		let start = Math.PI*3/2;
		let end;
		
		items.forEach((item, index) => {
			end = start + genItemPercent(index)*Math.PI*2;

			ctx.beginPath();
			ctx.moveTo(X,Y);
			ctx.arc(X, Y, R, start, end);
			ctx.fillStyle = colors[index];
			ctx.closePath();
			ctx.fill();

			// 在扇形中心绘制语言名
			let center = (start  + end) /2;
			let centerX = X + R * Math.cos(center);
			let centerY = Y + R * Math.sin(center);

			let textX = (X + centerX) / 2;
			let textY = (Y + centerY) / 2;

			ctx.font = TEXT_HEIGHT + "PX Times New Roman";
			ctx.fillStyle = "white";
			ctx.fillText(item.getAttribute("item"), textX ,textY);
			console.log(item.getAttribute("item"));
			texts.push({x: textX, y: textY});
			start = end;
			
		});
	
	}
	// 给画布加鼠标移动事件
	canvas.onmousemove = function(event){
		let targetIndex = getTargetIndex(event.offsetX,event.offsetY);
		if(target==-1){
			document.querySelector("#target").style.display = "none";
		}
	}


	// 根据画布上的鼠标坐标判断指向哪一个扇形中的文字区域
	function getTargetIndex(offsetX,offsetY){
		let targetIndex = -1;
		texts.forEach(({x,y},index) =>{
			let textWidth = ctx.measureText(items[index].getAttribute("item")).width;
		})
	}

</script>